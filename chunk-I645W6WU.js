import{b as fe,c as _e,d as Se,e as ve}from"./chunk-IDV4VZAQ.js";import{Ha as me,Ia as ce,Ja as o,Ka as pe,Na as de,Q as le,Sa as he,Ta as ue,Ua as ge,o as re}from"./chunk-HNXSPTRA.js";import{Aa as v,Ba as j,Ca as te,D as F,Ea as H,Eb as q,H as Z,Ha as W,I as B,Ia as G,M as O,N as R,Q as ee,Qa as M,R as L,Ra as w,aa as a,ba as D,c as T,ea as _,ga as d,ha as s,hb as ie,ia as l,ib as ne,ja as y,m as Y,mb as ae,na as z,pa as $,pb as oe,qa as h,rb as se,s as N,ua as J,z as V,za as m}from"./chunk-EIUYOAB2.js";import{a as A,b as U}from"./chunk-424C6UA6.js";function we(t,c){if(t&1&&(s(0,"div",16),y(1,"img",17),s(2,"div",18),m(3),l()()),t&2){let e=c.$implicit;a(1),J("src","assets/demo/images/jobs/icon_jobs_",e.icon,".png",L),a(2),v(e.label)}}function Pe(t,c){if(t&1&&(s(0,"div",19)(1,"div",18),m(2),l(),s(3,"div",18),m(4),M(5,"number"),M(6,"number"),l()()),t&2){let e=c.$implicit;a(2),v(e.label),a(2),te("( ",w(5,3,e.total)," accounts, ",w(6,5,e.totalPresets)," presets )")}}function je(t,c){if(t&1&&(s(0,"div",23),y(1,"img",24),s(2,"div",25),m(3),l()()),t&2){let e=h().$implicit;a(1),J("src","assets/demo/images/items/",e.id,".png",L),a(2),j(" ",e.name," ")}}function Te(t,c){if(t&1&&(s(0,"div",20),_(1,je,4,2,"div",21),y(2,"div",22),l()),t&2){let e=c.$implicit,n=h();a(1),d("ngIf",n.selectedItemId),a(1),d("innerHTML",e.desc,ee)}}function Ne(t,c){if(t&1){let e=z();s(0,"div")(1,"p-checkbox",32),$("ngModelChange",function(i){O(e);let r=h().$implicit,p=h();return R(p.isShowEnchant[r]=i)})("ngModelChange",function(){O(e);let i=h().$implicit,r=h();return R(r.onToggleShowEnchantClick(i))}),l()()}if(t&2){let e=h().$implicit,n=h();a(1),d("ngModel",n.isShowEnchant[e])("binary",!0)}}function Oe(t,c){if(t&1&&(s(0,"div",40),y(1,"img",24),s(2,"div",25),m(3),l()()),t&2){let e=h(2).$implicit;a(1),J("src","assets/demo/images/items/",e.ItemId,".png",L),a(2),j(" ",e.ItemName," ")}}var xe=function(){return{height:"8px"}},Ie=function(t){return{width:t}};function Re(t,c){if(t&1&&(s(0,"div",35),_(1,Oe,4,2,"div",36),s(2,"div",37)(3,"div",38),y(4,"div",39),l(),s(5,"span"),m(6),l()()()),t&2){let e=h().$implicit;a(1),d("ngIf",e.ItemId),a(2),d("ngStyle",W(10,xe)),a(1),H("bg-",e.ColorStyle," h-full"),d("ngStyle",G(11,Ie,e.Percentage+"%")),a(1),H("text-",e.ColorStyle," ml-2"),a(1),j("",e.Percentage," %")}}function Le(t,c){if(t&1&&(s(0,"div"),y(1,"img",24),s(2,"div"),m(3),l()()),t&2){let e=c.$implicit,n=h(2).$implicit;H("flex gap-1 ",n.EnchantInfos.length===3?"item_enchant":"",""),a(1),J("src","assets/demo/images/items/",e.id,".png",L),a(2),v(e.name)}}function $e(t,c){if(t&1&&(s(0,"div",41)(1,"div",42),_(2,Le,4,5,"div",43),l(),s(3,"div",37)(4,"div",38),y(5,"div",44),l(),s(6,"span",45),m(7),l()()()),t&2){let e=h().$implicit;a(2),d("ngForOf",e.EnchantInfos),a(2),d("ngStyle",W(4,xe)),a(1),d("ngStyle",G(5,Ie,e.Percentage+"%")),a(2),j("",e.Percentage," %")}}function Je(t,c){if(t&1&&(_(0,Re,7,13,"div",33),_(1,$e,8,7,"div",34)),t&2){let e=c.$implicit;d("ngIf",!e.IsEnchant),a(1),d("ngIf",e.IsEnchant)}}function Fe(t,c){if(t&1){let e=z();s(0,"div",26)(1,"div",27)(2,"div",28),m(3),l(),_(4,Ne,2,2,"div",29),l(),s(5,"p-listbox",30),$("ngModelChange",function(i){O(e);let r=h();return R(r.selectedItemId=i)})("onChange",function(){O(e);let i=h();return R(i.onItemChange())}),_(6,Je,2,2,"ng-template",31),l()()}if(t&2){let e=c.$implicit,n=h();d("hidden",!n.rankingMap[e].length),a(3),j(" ",e," "),a(1),d("ngIf",n.isItemHasEnchant[e]),a(1),d("options",n.rankingMap[e])("ngModel",n.selectedItemId)}}var be=()=>Object.values(o).reduce((t,c)=>(t[c]=[],t),{}),Ce=t=>Object.values(o).reduce((c,e)=>(c[e]=t,c),{}),Ee=(()=>{class t{constructor(e,n){this.summaryService=e,this.roService=n,this.jobChangeSource=new T,this.jobChangeEvent$=this.jobChangeSource.asObservable(),this.skillChangeSource=new T,this.skillChangeEvent$=this.skillChangeSource.asObservable(),this.itemChangeSource=new T,this.itemChangeEvent$=this.itemChangeSource.asObservable(),this.toggleShowEnchantSource=new T,this.toggleShowEnchantEvent$=this.toggleShowEnchantSource.asObservable(),this.subscribtions=[],this.isLoading=!1,this.allItemPositions=Object.values(o),this.allClasses=me(),this.allClasseMap=new Map(this.allClasses.map(i=>[i.value,i.label])),this.selectedJobId=this.allClasses[0].value,this.selectedJobName=this.allClasses[0].label,this.selectedSkillName="",this.itemMap={},this.jobSkillSummary={},this.presetSummary={},this.jobSummary={},this.totalSummary={},this.totalPresets=0,this.totalCurrentJobPresets=0,this.isShowEnchant=Ce(!1),this.isItemHasEnchant=Ce(!1),this.skillRankingList=[],this.rankingMap=be()}ngOnInit(){this.loadData(),this.subscribeEvent()}ngOnDestroy(){for(let e of this.subscribtions)e.unsubscribe()}loadData(){Y([this.summaryService.getJobSkillSummary(),this.summaryService.getJobPresetSummary(),this.summaryService.getJobSummary(),this.summaryService.getTotalSummary(),this.roService.getItems()]).subscribe(([e,n,i,r,p])=>{this.jobSkillSummary=e,this.presetSummary=n,this.jobSummary=i,this.totalSummary=r,this.itemMap=p,this.totalPresets=Object.values(n).reduce((g,u)=>g+Object.values(u).reduce((b,f)=>b+f,0),0),this.setSkillRanking(),this.setItemRanking()})}subscribeEvent(){let e=this.jobChangeEvent$.pipe(V(()=>this.isLoading=!0),N(50)).subscribe(()=>{this.setSkillRanking(),this.setItemRanking(),this.selectedJobName=this.allClasseMap.get(this.selectedJobId)||"",this.isLoading=!1}),n=this.skillChangeEvent$.pipe(V(()=>this.isLoading=!0),N(50)).subscribe(()=>{this.setItemRanking(),this.isLoading=!1}),i=this.itemChangeEvent$.pipe(N(50)).subscribe(()=>{let p=`${this.selectedItemId}`.split("-").map(Number).filter(Boolean);this.displaySelectedItems=[...new Set(p)].map(g=>{let u=this.itemMap[g]||{};return{id:g,desc:le(u.description),name:u.name}})}),r=this.toggleShowEnchantEvent$.pipe(N(50)).subscribe(p=>{this.setItemRanking(p)});this.subscribtions.push(e,n,i,r)}get itemRankingList(){return!this.selectedJobId||!this.selectedSkillName?be():this.totalSummary[this.selectedJobId][this.selectedSkillName]}get totalAccounts(){return this.jobSummary[this.selectedJobId]||0}setSkillRanking(){let e=this.jobSkillSummary[this.selectedJobId]||{},n=[];for(let[i,r]of Object.entries(e))n.push({value:i,label:i,total:Number(r),totalPresets:this.presetSummary[this.selectedJobId]?.[i]||0});this.skillRankingList=n.sort((i,r)=>r.total-i.total),this.selectedSkillName=n[0]?.value,this.totalCurrentJobPresets=Object.values(this.presetSummary[this.selectedJobId]).reduce((i,r)=>i+r,0)}setItemRanking(e){for(let n of this.allItemPositions){if(e&&n!==e)continue;let i=[],r=!1;for(let p of this.itemRankingList[n]){let g=Math.ceil(p.UsingRate*100/this.jobSkillSummary[this.selectedJobId][this.selectedSkillName]);i.push(U(A({},p),{Percentage:g,ItemName:this.itemMap[p.ItemId]?.name,ColorStyle:this.getItemBarColorStyle(n),IsEnchant:!1,EnchantInfos:[]}));let u=Object.entries(p.Enchants);if(r||(u.length===0||u.length===1&&u[0][0]==="0-0-0"?r=!1:r=!0),this.isShowEnchant[n]!==!0)continue;let b=u.sort(([f,x],[S,P])=>P-x).filter(([f,x],S)=>S<=4&&x>=.5);for(let[f,x]of b){let S=Math.floor(x*100/(p.TotalEnchant||1));if(S<=0)continue;let[P,I,C]=f.split("-").map(Number);if(P||I||C){let E=[P,I,C].filter(Number);i.push({ItemId:f,Enchants:{},UsingRate:0,ItemName:"",TotalAccount:0,TotalEnchant:0,TotalPreset:0,IsEnchant:!0,Percentage:S,ColorStyle:this.getItemBarColorStyle(n),EnchantInfos:E.map(k=>({id:k,name:this.itemMap[k]?.name}))})}}}this.isItemHasEnchant[n]=r,this.rankingMap[n]=i}}setItemRanking2(e){let n=this.jobSkillSummary[e]||{},i={};for(let[r]of Object.entries(n)){i[r]||(i[r]={});let p=this.totalSummary[e][r];for(let g of this.allItemPositions){let u=[],b=!1;for(let f of p[g]){let x=Math.ceil(f.UsingRate*100/this.jobSkillSummary[e][r]);u.push(U(A({},f),{Percentage:x,ItemName:this.itemMap[f.ItemId]?.name,ColorStyle:this.getItemBarColorStyle(g),IsEnchant:!1,EnchantInfos:[]}));let S=Object.entries(f.Enchants);if(b||(S.length===0||S.length===1&&S[0][0]==="0-0-0"?b=!1:b=!0),this.isShowEnchant[g]===!1)continue;let P=S.sort(([I,C],[E,k])=>k-C).filter(([I,C],E)=>E<=4&&C>=.5);for(let[I,C]of P){let E=Math.floor(C*100/(f.TotalEnchant||1));if(E<=0)continue;let[k,K,Q]=I.split("-").map(Number);if(k||K||Q){let Me=[k,K,Q].filter(Number);u.push({ItemId:I,Enchants:{},UsingRate:0,ItemName:"",TotalAccount:0,TotalEnchant:0,TotalPreset:0,IsEnchant:!0,Percentage:E,ColorStyle:this.getItemBarColorStyle(g),EnchantInfos:Me.map(X=>({id:X,name:this.itemMap[X]?.name}))})}}}i[r][g]=u}}return i}getItemBarColorStyle(e){switch(e){case o.Weapon:case o.WeaponCard:return"orange-500";case o.LeftWeapon:case o.LeftWeaponCard:return"orange-500";case o.Shield:case o.ShieldCard:return"pink-400";case o.HeadUpper:case o.HeadUpperCard:case o.HeadMiddle:case o.HeadMiddleCard:case o.HeadLower:return"blue-400";case o.Armor:case o.ArmorCard:case o.Garment:case o.GarmentCard:case o.Boot:case o.BootCard:return"red-500";case o.AccLeft:case o.AccLeftCard:case o.AccRight:case o.AccRightCard:return"teal-400";case o.CostumeEnchantUpper:case o.CostumeEnchantMiddle:case o.CostumeEnchantLower:case o.CostumeEnchantGarment:return"yellow-500";case o.ShadowWeapon:case o.ShadowShield:case o.ShadowArmor:case o.ShadowBoot:case o.ShadowEarring:case o.ShadowPendant:return"green-500";default:return"orange-500"}}onJobChange(){this.jobChangeSource.next(1)}onSkillChange(){this.skillChangeSource.next(1)}onItemChange(){this.itemChangeSource.next(1)}onToggleShowEnchantClick(e){this.toggleShowEnchantSource.next(e)}static{this.\u0275fac=function(n){return new(n||t)(D(pe),D(ce))}}static{this.\u0275cmp=Z({type:t,selectors:[["app-preset-summary"]],decls:39,vars:21,consts:[[1,"grid","grid-nogutter",2,"min-width","1500px"],[1,"col-12","mb-2"],[1,"grid","grid-nogutter","column_list"],[3,"options","ngModel","disabled","ngModelChange","onChange"],["pTemplate","item","class","py-0"],[1,"col-12","grid","grid-nogutter"],[1,"col-3"],[1,"card","text-lg","m-0","p-2"],[1,"text-primary","text-lg"],[1,"mr-2","font-medium"],[1,"text-primary"],[1,"card","px-1","py-3","sticky","desc-sticky"],[1,"text-lg","font-bold","mb-3"],["class","mb-4",4,"ngFor","ngForOf"],[1,"col-9","grid","grid-nogutter"],["class","col-6 p-1",3,"hidden",4,"ngFor","ngForOf"],[1,"flex","gap-2","py-0"],["alt","",1,"job_img",3,"src"],[1,"text_ellips"],[1,"w-full","flex","justify-content-between"],[1,"mb-4"],["class","flex gap-1 mb-2",4,"ngIf"],[1,"px-2","py-2",2,"color","#000","background-color","#fff",3,"innerHTML"],[1,"flex","gap-1","mb-2"],["alt","",1,"item_img",3,"src"],[1,"text_ellips","font-medium"],[1,"col-6","p-1",3,"hidden"],[1,"card","m-0","p-2","flex","justify-content-around"],[1,"font-bold","text-lg"],[4,"ngIf"],["optionValue","ItemId",3,"options","ngModel","ngModelChange","onChange"],["pTemplate","item","styleClass","py-0 xxx"],["label","Show enchant",3,"ngModel","binary","ngModelChange"],["class","flex w-full justify-content-between",4,"ngIf"],["class","flex pl-4 w-full justify-content-between",4,"ngIf"],[1,"flex","w-full","justify-content-between"],["class","flex gap-1",4,"ngIf"],[1,"mt-2","md:mt-0","flex","align-items-center",2,"min-width","130px"],[1,"surface-300","border-round","overflow-hidden","w-10rem","lg:w-6rem",3,"ngStyle"],[3,"ngStyle"],[1,"flex","gap-1"],[1,"flex","pl-4","w-full","justify-content-between"],[1,"flex","gap-2","w-full"],[3,"class",4,"ngFor","ngForOf"],[1,"bg-yellow-300","h-full",3,"ngStyle"],[1,"text-yellow-300","ml-2"]],template:function(n,i){n&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-listbox",3),$("ngModelChange",function(p){return i.selectedJobId=p})("onChange",function(){return i.onJobChange()}),_(4,we,4,2,"ng-template",4),l()()(),s(5,"div",5)(6,"div",6)(7,"div",7)(8,"div"),m(9,"Information date: 31-05-2568"),l(),s(10,"div"),m(11," Total "),s(12,"span",8),m(13),M(14,"number"),l(),m(15," accounts, "),s(16,"span",8),m(17),M(18,"number"),l(),m(19," presets "),l(),s(20,"div")(21,"span",9),m(22),l(),s(23,"span",10),m(24),M(25,"number"),l(),m(26," accounts, "),s(27,"span",10),m(28),M(29,"number"),l(),m(30," presets "),l()(),s(31,"p-listbox",3),$("ngModelChange",function(p){return i.selectedSkillName=p})("onChange",function(){return i.onSkillChange()}),_(32,Pe,7,7,"ng-template",4),l(),s(33,"div",11)(34,"div",12),m(35,"Descri\xE7\xE3o do Item"),l(),_(36,Te,3,2,"div",13),l()(),s(37,"div",14),_(38,Fe,7,5,"div",15),l()()()),n&2&&(a(3),d("options",i.allClasses)("ngModel",i.selectedJobId)("disabled",i.isLoading),a(10),v(w(14,13,i.jobSummary[0])),a(4),v(w(18,15,i.totalPresets)),a(5),v(i.selectedJobName),a(2),v(w(25,17,i.totalAccounts)),a(4),v(w(29,19,i.totalCurrentJobPresets)),a(3),d("options",i.skillRankingList)("ngModel",i.selectedSkillName)("disabled",i.isLoading),a(5),d("ngForOf",i.displaySelectedItems),a(2),d("ngForOf",i.allItemPositions))},dependencies:[Se,re,ie,ne,ae,he,ue,fe,oe],styles:["[_nghost-%COMP%]     .column_list p-listbox .p-listbox-list{min-width:1480px;columns:10;padding:0}[_nghost-%COMP%]     .column_list .p-listbox-item{padding:.5rem}.job_img[_ngcontent-%COMP%]{height:fit-content}.desc-sticky[_ngcontent-%COMP%]{top:40px;height:100vh;overflow:auto}.item_img[_ngcontent-%COMP%]{height:fit-content}.item_enchant[_ngcontent-%COMP%]{width:33.33%}"]})}}return t})();var ke=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=B({type:t})}static{this.\u0275inj=F({imports:[q.forChild([{path:"",component:Ee}]),q]})}}return t})();var mt=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=B({type:t})}static{this.\u0275inj=F({imports:[ke,ve,de,se,ge,_e]})}}return t})();export{mt as PresetSummaryModule};
